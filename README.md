# PhotoBackSwap

## 项目介绍

西南大学人工智能学院暑期三下乡AI照相馆——AI云旅游代码实现。

虽然现在有众多图像处理能够实现类似功能，但是面对一百多张的照片，工作量还是太大难以实现。这个项目将这个过程自动化，利用深度学习技术，实现头发丝级别的抠图与背景替换。

## 项目参考

本项目是BackgroundMappingV2的简化版，只处理单帧图片，同时针对实际拍摄情况，对代码进行了部分修改。

## 项目实现内容

1. **图像尺寸预处理**：
   - 原始项目要求三张图像大小一致，且图像大小必须是4的倍数。本项目通过OpenCV对图像尺寸进行预处理（缩放至与第一张图片大小相同，并且就近取整为4的倍数），以便处理不同图像大小，并解决潜在的错误。

2. **图像缩放与位置调整**：
   - 原始项目仅有叠加功能，不能调整图像大小与位置，导致生成的图像人像过大。我们通过OpenCV进一步预处理图像，引入缩放比和图像位置参数，以便更容易调整人像位置与大小。
   - 参数解释：缩放比：人像图像相对于原始图像的百分比；图像位置：0（缩放后图像与背景左下角对齐，也就是靠左下）、1（缩放后图像中线与背景中线重合，下方对其，也就是居中）、2（缩放后图像靠右下角对齐）
   
3. **背景复杂度控制与网络对比**：
   - 在实际应用中，我们采用幕布控制背景复杂度。实践表明，保持其他参数不变，在三种网络：ResNet50、ResNet101与MobileNetV2的对比中，ResNet50效果最佳，MobileNetV2效果次之，而ResNet101会出现抠图不彻底的情况。

## 使用方法

### 环境要求

请确保已安装以下环境和库：

- Python 3.12
- OpenCV
- TensorFlow / PyTorch (根据使用的深度学习模型)

### 安装依赖

```bash
pip install -r requirements.txt
```

### 运行程序

1. 将原始项目的三个模型放在`model` 文件夹中。(pytorch_mobilenetv2.pth、pytorch_resnet50.pth、pytorch_resnet101.pth)
2. 执行以下命令启动脚本，按照提示设置相关参数。

```bash
python BG_Swap.py
```

### 输出结果

处理后的图像将保存在 `content/new` 文件夹中。

## 贡献

欢迎提出问题或贡献代码，请提交pull request或报告issue。
